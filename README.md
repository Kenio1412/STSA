# STSA

[TOC]

A tool for handling single-table substitution encryption



This is a normal course assignment. If I have time, I will continue the maintenance.



下面是应**作业要求**上传的报告（删了一些部分），大家可以忽略



# **1.** 作品功能与性能说明

**功能：**

该作品——单表代换工具主要有以下功能：

(1) 实现凯撒密码的加密解密

(2) 实现Affine密码的加密解密，并能识别非唯一解的密钥

(3) Playfair密码的加密解密

(4) Atbash密码的加密解密

(5) 单字符或多字符的代换操作

(6) 统计输入文本的字母频率（包括单字母、双字母、三字母组合）

(7) 对被凯撒密码加密后的文本进行分析。返回1或2个可能密钥。

(8) 利用重合指数法，判断输入文本是否大概率为单表代换。

(9) 利用英文统计特性，找出文本中最有可能为the的三个字母。

(10) 预测下一个未被替换的出现频率最高的字母的可能值。

(11) 利用已经替换过的字母和连接特性，预测新的字母

(12) 撤回上一步操作（RollBack）。

(13) 撤回撤回的操作，即取消撤回（Forward）。

(14) 显示Tips。显示一些英文统计特征以及连接特征（预设固定值）。

(15) 源代码中还有用于爬取英文统计特征的爬虫代码。

**性能说明：**

我们以完整完成上述(1)(2)(5)(6)(7)(8)(9)(10)(12)(13)功能为一个周期进行测试。

(1) 运算速度快，长度约为500的文本只需要0.002s，长度约为500000的文本只需要0.8s。完全可以满足使用者的分析要求。

(2) 文本频率越接近英文统计特性预测结果正确概率越高。且本工具有多种分析方式，会给出多个可能替换方案，具有良好的鲁棒性。

**GitHub仓库：**

https://github.com/Kenio1412/STSA.git

# 2.设计与实现方案

## 2.1 实现原理

（硬件框图、软件流程、相关描述等）

**设计：**

该工具包括四个主要部分：4个经典的单表代换加解密算法，利用英文统计特征实现的智能化建议提示，多窗口交互的GUI设计，测试单元。GUI部分使用了pyside6。

该程序的具体实现主要由以下几部分组成（按实现顺序排列）

(1) Function.py ： 包括了基本的加密解密算法，和密文分析算法。作为一个函数库使用。

(2) Analyze.py ：包括了一个分析密文的类（Analyze），利用Function.py中的函数实现主要的分析功能

(3) Process.py ： 包括了一个处理的类（Process），是对密文进行操作的主要类，利用Function.py中的函数实现主要处理功能。并使用了Analyze类，获得分析结果。

(4) ui_windows.py：主窗口的结构类，拥有主窗口的所有结构。

(5) ui_sub_windows.py：子窗口的结构类，拥有子窗口所有结构。

(6) MainForm.py ： 内含MainWindow和SubWindow两个类，分别继承(4)(5)中的两个类，并且使用(2)(3)中的类，完全实现工具功能与主子窗口的交互。

(7) main.py ：调用(6)，实现功能。

**实现方案：**

（1）凯撒密码、仿射密码、Playfair密码、Atbash密码、单字符或多字符代换均可以用定义，编写程序获得

（2）频率分析：统计单个、两个、三个字符出现的次数（忽略空格）。计算总数，获得频率。

（3）凯撒密钥分析：通过识别a-e-i或r-s-t三元组的频率峰，或jk和xyz的特征，可以获得密钥。本工具连用三组比较，获得三个密钥值。若有两个密钥值相同则返回该密钥。若三个均不相同，则分别算得三个密钥处理下的密文和标准英文字母统计规律之间的**KL散度（相对熵）**，选取最小的两个值返回。

（4）判断是否为单表代换：利用**重合指数法**，计算密文的Ic，若在可接受的（0.065-ε，0.065+ε），范围内，则返回True。在代码中，此方法有普通检验和卡方检验两种方式。判断按钮点下后，同时返回两个值。（代码中ε=0.005）

（5）预测the：这主要是利用了标准分布下t、e、th、he、the概率。在一二三元前5名（可调的参数）中，只有the三个字母，能有如此多的组合。**倘若有两个高概率二元字母，它们头尾相同，且组合在一起能成为三元的高概率词，且二元字母中不相同的两个字母也都是高概率单字母。**那么这三个字符有非常非常大的概率是the。可以通过调整选择概率的范围，让the的选择范围伸缩。

（6）预测char（单个字符）：从密文单字符频率中找到第一个还未被破解（未被替换过）的字符A，匹配上标准统计频率中还没被破解的前三个（按频率大小降序）字符a,b,c。依次将未被替换过的字符替换成a\b\c，每次替换执行如下操作：

① 在密文二、三元频率中找到含有A的组合。将找到的组合与标准统计频率中的二三元组合进行匹配。我们设小写字母为已被替换过的密文，即可信任为明文。大写字母为密文。匹配规则如下：密文组合oA会匹配上标准统计频率中的oa\ob\oc，密文组合XA会匹配上标准统计中xa\xb\xb（x为任意字符）中频率最高的组合。这样，每一个含有A的组合都能匹配到对应的明文组合。

② 通过上面的匹配规则，我们通过二元三元分别得到两个字典，一共四个字典。形如{字符 : 频率}。为密文二元、三元序列，明文二元、三元序列，且彼此一一对应。我们将每个字典内部的频率进行归一化。

③ 我们分别计算明密文二元、三元之间的相对熵。并按比例相加 **value = k1\*D(p2||q2)+k2\*D(p3||q3)** ,在代码中 k1=k2=1。 但后续维护可能会通过大量文本训出个合适的k1/k2。

④ 选取 a\b\c中value最小的一个值返回，作为预测值。

（7）利用连接特性预测：在英文连接特性中，

\- q后几乎百分之百连接着u
	- x前几乎总是i和e，只在极个别情况下是o和a
	- e和e之间，r的出现频率很高

这只会在q\x\e至少找到一个后才起作用。

（8）用pyside6-Designer构建UI时会不断重置py文件，这不利于我们基于生成的py文件设计新功能。于是，我采用了类继承的方式，用一个新的类来控制窗体。不同的窗体之间用signal类传递信息。

**类图：**

下面是各个类的类图。

![img](pictures\Analyze.png)![img](D:\study\university\CS\python\python_code\STSA\pictures\Process.png) 

![img](pictures\main.png) 

![img](D:\study\university\CS\python\python_code\STSA\pictures\MainForm.png) 

**软件运行流程：**

本软件流程较为自由，当输入文本后，可以按需求（需要进行的加解密操作或者分析）随意点击。对于不合理的操作，本软件也会自行给出提示。

若需要详细具体的流程图，可在https://github.com/Kenio1412/STSA.git中picture文件夹下，找到STSA1.png。缩略图如下：

![img](pictures\STSA1.png) 

## 2.2参考文献

(1) pyside6文档[PySide6.QtGui - Qt for Python](https://doc.qt.io/qtforpython-6/PySide6/QtGui/index.html)

(2) 密码学导论PPT - Crypto01-古典密码学

## 2.3 运行结果

![img](pictures\runtime_0.png) 

![img](pictures\runtime_1.png)![img](pictures\runtime_2.png) 

![img](pictures\runtime_3.png)![img](pictures\runtime_4.png) 

![img](pictures\runtime_5.png)![img](pictures\runtime_6.png) 

![img](pictures\runtime_7.png)![img](pictures\runtime_7.png) 

## 技术指标

(1) 500000字符文本可在0.8s左右完成一周期处理

(2) 包含单表代换解密时的几乎所有可能用到的操作（频率分析，多个字符替换，可撤回）。

# 3.系统测试与结果

 

## 3.1测试方案

(1) 使用pycharm自带分析功能，分析

(2) 性能：分别使用长度为500 - 500000（间隔为500）的文本完成一整个周期的操作,计算时间

## 3.2 功能测试

检测加解密功能是否正常，检测GUI设计是否合理，检测分析程序是否正常。方案见3.1。

## 3.3 性能测试

检测运行文本所花时间，检测分析正确率。方案见3.1。

# 4.应用前景

(1)可以用来作为单表代换密文破解的辅助工具。

(2)可以用来作为凯撒密码、放射密码、Atbash密码、Playfair密码的加解密工具

(3)可以用来作为对一段文本字母频率分析的工具

(4)可以以此为起点，引入更多加密方式和分析技巧。

# 5.结论

从功能上看，该工具包含了破解单表代换密码的大部分需要操作（频率分析、多字符代换、可撤回、智能提示、常见加解密方式）。作为一个辅助工具，它是非常实用的。但它无法完全替代人，它需要人主观的判断。同时，本工具对一些非法操作也有防范。比如在初始状态就按下了回滚按钮，在最新状态仍按下Forward键，没有按LOAD,就直接进行加解密操作，仿射密码密钥选择了不可逆元等等。

从代码方面看，本工具把经常要改动的ui文件生成的类，以继承的方式，传递到一个主操作的类。这方便了后续框体的调整，大大提高了代码可修改性、易扩展性。本工具所使用的外部文本均以爬虫的形式获取，也方便在后续网页资源更新后的重构工作。

从ui上看，本工具给一些名字奇怪的按钮都添加了注释。只需要把鼠标暂停在对应按钮上，就能看到相应的注释。还额外添加了tips按钮，让不知道英文统计特征的人直接了解。我们将所有没被破解的字母用大写形式表现，已经替换过的用小写的形式表现。让使用者更容易区分。

总而言之，这是一个轻量级的操作方便的好用的辅助工具。

 

 